<header>
  <div
    class="button-group">
    <button
      (click)="decreaseFontSize()"
      [disabled]="data.theme.fontSize === MIN_FONT_SIZE">aa</button>
    <button
      (click)="increaseFontSize()"
      [disabled]="data.theme.fontSize === MAX_FONT_SIZE">AA</button>
  </div>

  <select
    (change)="changeFontFamily($event)">
    <option
      value="">Default</option>
    <option
      value="sans-serif">Sans-Serif</option>
    <option
      value="serif">Serif</option>
  </select>
</header>

<div class="cv">
  <div
    *ngIf="data"
    [style.fontSize]="data.theme.fontSize + 'em'"
    [style.fontFamily]="data.theme.fontFamily"
    [class]="data.theme.class">

    <!-- DETAILS -->

    <div
      (click)="openModal($event, data, 'details', TYPES.DETAILS)"
      class="details modal-edit">

      <div
        class="name">
        {{ data.details.name }}
      </div>

      <div>
        <div
          class="address">
          {{ data.details.address }}
        </div>

        <div
          class="tel">
          {{ data.details.tel }}
        </div>
      </div>

      <div>
        <a
          [attr.href]="'mailto:' + data.details.email"
          class="email">
          {{ data.details.email }}
        </a>

        <a
          [attr.href]="data.details.url"
          class="url"
          target="_blank">
          {{ data.details.url }}
        </a>
      </div>
    </div>

    <!-- ITEMS -->

    <div class="items">
      <div
        *ngFor="let item of data.items"
        class="item">

        <!-- DIVIDER -->

        <div
          *ngIf="item.class === TYPES.DIVIDER.class"
          [class]="item.class">
          <div
            *ngIf="item.title"
            (click)="editField($event, item, 'title')"
            class="editable title">
            {{ item.title }}
          </div>
        </div>

        <!-- EDUCATION -->

        <div
          *ngIf="item.class === TYPES.EDUCATION.class"
          [class]="item.class">
          <div
            (click)="editField($event, item, 'title')"
            class="editable title">
            {{ item.title }}
            <span
              (click)="openModal($event, item, 'items', TYPES.EDUCATION)"
              class="icon-btn">+</span>
          </div>

          <div
            *ngFor="let child of item.items; let idx = index"
            (click)="openModal($event, item, 'items', TYPES.EDUCATION, idx)"
            class="child modal-edit">

            <div class="left">
              <div
                class="title">
                {{ child.title }}
              </div>

              <div class="timespan">
                <div
                  class="start">
                  {{ child.start ? (child.start | date:'MM/yy') : 'present' }}
                </div>
                <div
                  class="end">
                  {{ child.end ? (child.end | date:'MM/yy') : 'present' }}
                </div>
              </div>
            </div>

            <div class="right">
              <a
                class="institution"
                [attr.href]="child.link"
                target="_blank">
                {{ child.institution }}
              </a>

              <div
                class="location">
                {{ child.location }}
              </div>
              <div
                class="description">
                {{ child.description }}
              </div>
              <div
                class="field">
                {{ child.field }}
              </div>
              <div
                class="grade">
                {{ child.grade }}
              </div>
            </div>
          </div>
        </div>

        <!-- SKILL -->

        <div
          *ngIf="item.class === TYPES.SKILL.class"
          [class]="item.class">
          <div
            (click)="editField($event, item, 'title')"
            class="editable title">
            {{ item.title }}
            <span
              (click)="openModal($event, item, 'items', TYPES.SKILL)"
              class="icon-btn">+</span>
          </div>

          <div
            *ngFor="let child of item.items; let idx = index"
            (click)="openModal($event, item, 'items', TYPES.SKILL, idx)"
            class="child modal-edit">
            <div
              class="title">
              {{ child.title }}
            </div>

            <div class="bar">
              <div
                *ngIf="child.percentage"
                class="wrapper">
                <div
                  class="percentage"
                  [style.width]="child.percentage + '%'">
                </div>
              </div>

              <div
                *ngIf="child.description"
                class="description">
                {{ child.description }}
              </div>
            </div>
          </div>
        </div>

        <!-- DETAIL_LIST -->

        <div
          *ngIf="item.class === TYPES.DETAIL_LIST.class"
          [class]="item.class">
          <div
            (click)="editField($event, item, 'title')"
            class="editable title">
            {{ item.title }}
            <span
              (click)="openModal($event, item, 'items', TYPES.DETAIL_LIST)"
              class="icon-btn">+</span>
          </div>

          <div
            *ngFor="let child of item.items; let idx = index"
            (click)="openModal($event, item, 'items', TYPES.DETAIL_LIST, idx)"
            class="child modal-edit">
            <div class="left">
              <div
                class="title">
                {{ child.title }}
              </div>

              <div class="timespan">
                <div
                  *ngIf="child.start"
                  class="start">
                  {{ child.start ? (child.start | date:'MM/yy') : 'present' }}
                </div>
                <div
                  class="end">
                  {{ child.end ? (child.end | date:'MM/yy') : 'present' }}
                </div>
              </div>
            </div>

            <div class="right">
              <a
                *ngIf="child.institution"
                class="institution"
                [attr.href]="child.link"
                target="_blank">{{ child.institution }}</a>

              <div
                *ngIf="child.location"
                class="location">{{ child.location }}</div>

              <div
                class="description">{{ child.description }}</div>

              <div class="tags">
                <div
                  (click)="editField($event, tag, 'name')"
                  *ngFor="let tag of child.tags"
                  class="tag">
                  {{ tag.name }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- RECOMMENDATION -->

        <div
          *ngIf="item.class === TYPES.RECOMMENDATION.class"
          [class]="item.class">
          <div
            (click)="editField($event, item, 'title')"
            class="editable title">
            {{ item.title }}
            <span
              (click)="openModal($event, item, 'items', TYPES.RECOMMENDATION)"
              class="icon-btn">+</span>
          </div>

          <div
            *ngFor="let child of item.items; let idx = index"
            (click)="openModal($event, item, 'items', TYPES.RECOMMENDATION, idx)"
            class="child modal-edit">
            <div
              class="name">
              {{ child.name }}
            </div>
            <div
              class="relationship">
              {{ child.relationship }}
            </div>
            <div
              class="institution">
              {{ child.institution }}
            </div>
            <div
              class="comment">
              {{ child.comment }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div
  #inputWrapperRef
  class="input-wrapper">

  <input
    #inputRef>

  <div class="buttons">
    <button
      (click)="cancelEdit()">Cancel</button>
    <button
      (click)="saveChanges()">Save</button>
  </div>
</div>

<div
  *ngIf="modal"
  (click)="backdropClose($event)"
  class="modal-wrapper">
  <form
    class="modal"
    (submit)="submitModal($event)">

    <div>
      <span>{{ modal.isAdding ? 'New' : 'Update' }} entry</span>

      <button
        class="btn btn-primary btn-sm"
        type="submit">
        {{ modal.isAdding ? 'Save' : 'Update'}}
      </button>

      <button
        *ngIf="modal.isEditing"
        class="btn btn-warning btn-sm"
        type="button"
        (click)="deleteModalItem()">
        Delete
      </button>

      <button
        class="btn btn-secondary btn-sm"
        type="button"
        (click)="clearModal()">
        Cancel
      </button>
    </div>

    <div
      *ngFor="let field of modal.fields"
      class="form-group">
      <label>{{ field.label }}</label>

      <input
        *ngIf="field.type === 'text' || field.type === 'number' || field.type === 'email' || field.type === 'url' || field.type === 'date' || field.type === 'month'"
        [type]="field.type"
        [name]="field.label"
        [placeholder]="field.placeholder"
        [(ngModel)]="field.value"
        class="form-control">

      <textarea
        *ngIf="field.type === 'textarea'"
        [name]="field.label"
        [placeholder]="field.placeholder"
        [(ngModel)]="field.value"
        class="form-control">
      </textarea>
    </div>
  </form>
</div>
